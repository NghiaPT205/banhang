<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</title>

  <!-- Bootstrap 5 + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

  <style>
    :root{
      --blue:#0d6efd;
      --shadow: 0 10px 25px rgba(0,0,0,.12);
    }
    body{ background:#f3f5f9; }
    .wrap{ max-width:1200px; margin:40px auto; padding:0 16px; }
    .card-main{
      border:0; border-radius:10px; overflow:hidden; box-shadow:var(--shadow);
    }
    .topbar{
      background:var(--blue);
      color:#fff;
      padding:12px 18px;
      font-weight:700;
      display:flex; align-items:center; gap:10px;
    }
    .btn-add{
      background:#1f9d55; border:0;
      box-shadow:0 6px 16px rgba(31,157,85,.25);
    }

    .table-wrap{
      border-radius:10px; overflow:hidden;
      border:1px solid rgba(0,0,0,.06);
    }
    thead th{
      background:#1f232a !important;
      color:#fff !important;
      padding:14px 12px !important;
      font-weight:700;
    }
    tbody td{ padding:12px !important; vertical-align:middle; }

    .badge-status{
      padding:6px 12px;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
      color:#fff;
    }
    .badge-active{ background:#198754; }
    .badge-lock{ background:#6c757d; }

    .btn-action{
      padding:6px 10px; border-radius:6px; border:0;
      font-weight:700;
    }
    .btn-edit{ background:#ffc107; }
    .btn-del{ background:#dc3545; color:#fff; }

    .modal-content{ border:0; border-radius:12px; box-shadow:var(--shadow); }
    .modal-header{
      background:var(--blue);
      color:#fff;
      border-bottom:0;
      padding:12px 16px;
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card card-main">

    <div class="topbar">
      <i class="bi bi-person-badge"></i>
      <span>Qu·∫£n l√Ω ng∆∞·ªùi d√πng &amp; ph√¢n quy·ªÅn</span>
    </div>

    <div class="card-body p-3 p-md-4">

      <!-- N√∫t th√™m -->
      <button id="btnAdd" class="btn btn-add text-white">
        <i class="bi bi-plus-lg me-1"></i> Th√™m ng∆∞·ªùi d√πng
      </button>

      <!-- üîç T√åM KI·∫æM (m·ªõi th√™m duy nh·∫•t) -->
      <div class="mt-3" style="max-width:350px">
        <input id="searchInput" class="form-control"
               placeholder="üîç T√¨m username, h·ªç t√™n, quy·ªÅn...">
      </div>

      <div class="table-wrap mt-3">
        <table class="table table-hover mb-0">
          <thead>
            <tr>
              <th>Username</th>
              <th>H·ªç t√™n</th>
              <th>Quy·ªÅn</th>
              <th>Tr·∫°ng th√°i</th>
              <th>Ch·ª©c nƒÉng</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="userModal">
  <div class="modal-dialog modal-dialog-centered" style="max-width:520px;">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Th√¥ng tin ng∆∞·ªùi d√πng</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body p-4">
        <form id="form">
          <input type="hidden" id="id">

          <div class="mb-3">
            <input class="form-control" id="username" placeholder="Username" required>
          </div>

          <div class="mb-3">
            <input type="password" class="form-control" id="password" placeholder="M·∫≠t kh·∫©u">
          </div>

          <div class="mb-3">
            <input class="form-control" id="fullname" placeholder="H·ªç t√™n" required>
          </div>

          <div class="mb-3">
            <select class="form-select" id="role">
              <option>Admin</option>
              <option selected>Nh√¢n vi√™n</option>
              <option>Kh√°ch h√†ng</option>
            </select>
          </div>

          <div>
            <select class="form-select" id="status">
              <option selected>Ho·∫°t ƒë·ªông</option>
              <option>T·∫°m kh√≥a</option>
            </select>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button id="btnSave" class="btn btn-primary">L∆∞u</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
      </div>

    </div>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
const KEY = "ui_users_demo_v1";

const seed = [
  {id:1, username:"admin", fullname:"Qu·∫£n tr·ªã h·ªá th·ªëng", role:"Admin", status:"Ho·∫°t ƒë·ªông"},
  {id:2, username:"nha@gmail.com", fullname:"Vi√™n Thanh Nh√£", role:"Nh√¢n vi√™n", status:"Ho·∫°t ƒë·ªông"},
];

function load(){
  const raw = localStorage.getItem(KEY);
  if(!raw){ localStorage.setItem(KEY, JSON.stringify(seed)); return [...seed]; }
  return JSON.parse(raw);
}
function save(data){ localStorage.setItem(KEY, JSON.stringify(data)); }

let users = load();

/* ===== l·∫•y element ===== */
const tbody = document.getElementById("tbody");
const searchInput = document.getElementById("searchInput");

const id = document.getElementById("id");
const username = document.getElementById("username");
const fullname = document.getElementById("fullname");
const role = document.getElementById("role");
const status = document.getElementById("status"); // ‚úÖ fix undefined

/* ===== badge ===== */
function badge(s){
  return `<span class="badge-status ${s==="Ho·∫°t ƒë·ªông"?"badge-active":"badge-lock"}">${s}</span>`;
}

/* ===== render + search ===== */
function render(keyword=""){
  const k = keyword.toLowerCase();

  const filtered = users.filter(u =>
    u.username.toLowerCase().includes(k) ||
    u.fullname.toLowerCase().includes(k) ||
    u.role.toLowerCase().includes(k)
  );

  tbody.innerHTML = filtered.map(u => `
    <tr>
      <td>${u.username}</td>
      <td>${u.fullname}</td>
      <td>${u.role}</td>
      <td>${badge(u.status)}</td>
      <td>
        <button class="btn-action btn-edit" onclick="editUser(${u.id})">S·ª≠a</button>
        <button class="btn-action btn-del" onclick="delUser(${u.id})">X√≥a</button>
      </td>
    </tr>
  `).join("");
}

searchInput.oninput = () => render(searchInput.value);

/* ===== CRUD gi·ªØ nguy√™n ===== */
const modal = new bootstrap.Modal(userModal);

btnAdd.onclick = ()=>{
  form.reset();
  id.value="";
  modal.show();
};

function editUser(i){
  const u=users.find(x=>x.id===i);
  id.value=u.id;
  username.value=u.username;
  fullname.value=u.fullname;
  role.value=u.role;
  status.value=u.status;
  modal.show();
}

function delUser(i){
  if(confirm("X√≥a ng∆∞·ªùi d√πng?")){
    users=users.filter(x=>x.id!==i);
    save(users);
    render(searchInput.value);
  }
}

btnSave.onclick=()=>{
  const data={
    id:id.value?+id.value:Date.now(),
    username:username.value,
    fullname:fullname.value,
    role:role.value,
    status:status.value
  };

  const idx=users.findIndex(x=>x.id===data.id);
  if(idx>=0) users[idx]=data;
  else users.push(data);

  save(users);
  modal.hide();
  render(searchInput.value);
};

render();
</script>
</body>
</html>
